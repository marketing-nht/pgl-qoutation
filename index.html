import React, { useState, useMemo, useRef, useEffect } from 'react';
import { LucideSearch, LucideX, LucideShoppingCart, LucidePlus, LucideMinus, LucideTrash2, LucideMail, LucideHome, LucideFileText, LucideUser, LucideCheckCircle, LucideAlertCircle, LucideInfo } from 'lucide-react';

// ==========================================
// 1. TYPES & ENUMS
// ==========================================

const Tab = {
  Home: 'home',
  Search: 'search',
  Quotes: 'quotes',
  Account: 'account',
};

const FilterCategory = {
  ALL: "T·∫•t c·∫£",
  ENERGY: "Hi·ªáu su·∫•t nƒÉng l∆∞·ª£ng",
  CR_HOUSEHOLD: "H·ª£p quy Gia d·ª•ng",
  CR_TELECOM: "Vi·ªÖn th√¥ng & CNTT",
  SAFETY: "An to√†n ƒëi·ªán",
  SOCKET: "·ªî c·∫Øm & Ph√≠ch c·∫Øm",
  SAR: "M·ª©c h·∫•p th·ª• ri√™ng (SAR)",
};

const QUOTATION_INFO = {
  number: "26012001/PGL-BG",
  date: "20/01/2026",
  validity: "30 ng√†y"
};

// ==========================================
// 2. DATABASE (C·∫¨P NH·∫¨T ƒê·∫¶Y ƒê·ª¶ T·ª™ B√ÅO GI√Å 20/01/2026)
// ==========================================

const MOCK_PRODUCTS = [
    // =========================================================================
    // 1. NH√ìM T·ª¶ L·∫†NH & T·ª¶ ƒê√îNG (Refrigerator & Freezer) - ƒê√É B·ªî SUNG
    // =========================================================================
    {
        id: 'ref-cert',
        name: 'T·ªß l·∫°nh/T·ªß ƒë√¥ng/T·ªß m√°t (Ch·ª©ng nh·∫≠n)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'C·∫•p Gi·∫•y ch·ª©ng nh·∫≠n H·ª£p quy',
        price: 2000000,
        description: 'Ch·ª©ng nh·∫≠n CR cho t·ªß l·∫°nh, t·ªß k·∫øt ƒë√¥ng, t·ªß gi·ªØ l·∫°nh th∆∞∆°ng m·∫°i.',
        keywords: ['t·ªß l·∫°nh', 't·ªß ƒë√¥ng', 't·ªß m√°t', 'refrigerator', 'freezer', 'fridge']
    },
    {
        id: 'ref-vneep',
        name: 'T·ªß l·∫°nh/T·ªß ƒë√¥ng/T·ªß m√°t (Hi·ªáu su·∫•t)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 7828:2016',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t nƒÉng l∆∞·ª£ng',
        price: 9000000,
        description: 'Th·ª≠ nghi·ªám d√°n nh√£n nƒÉng l∆∞·ª£ng VNEEP.',
        keywords: ['t·ªß l·∫°nh', 't·ªß ƒë√¥ng', 't·ªß m√°t', 'vneep']
    },
    {
        id: 'ref-emc',
        name: 'T·ªß l·∫°nh/T·ªß ƒë√¥ng/T·ªß m√°t (EMC)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'Th·ª≠ nghi·ªám Nhi·ªÖu ƒëi·ªán t·ª´ (EMC)',
        price: 9000000,
        description: 'Th·ª≠ nghi·ªám t∆∞∆°ng th√≠ch ƒëi·ªán t·ª´.',
        keywords: ['t·ªß l·∫°nh', 't·ªß ƒë√¥ng', 'emc']
    },

    // =========================================================================
    // 2. NH√ìM M√ÅY GI·∫∂T (Washing Machine) - ƒê√É B·ªî SUNG
    // =========================================================================
    {
        id: 'wash-cert',
        name: 'M√°y gi·∫∑t gia d·ª•ng (Ch·ª©ng nh·∫≠n)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'C·∫•p Gi·∫•y ch·ª©ng nh·∫≠n H·ª£p quy',
        price: 2000000,
        description: 'Ph√≠ c·∫•p gi·∫•y ch·ª©ng nh·∫≠n CR.',
        keywords: ['m√°y gi·∫∑t', 'washing machine']
    },
    {
        id: 'wash-vneep-small',
        name: 'M√°y gi·∫∑t (<= 10kg) (Hi·ªáu su·∫•t)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 8526:2013',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t nƒÉng l∆∞·ª£ng',
        price: 2500000,
        description: 'Cho m√°y gi·∫∑t kh·ªëi l∆∞·ª£ng <= 10kg.',
        keywords: ['m√°y gi·∫∑t', 'vneep']
    },
    {
        id: 'wash-vneep-large',
        name: 'M√°y gi·∫∑t (> 10kg) (Hi·ªáu su·∫•t)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 8526:2013',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t nƒÉng l∆∞·ª£ng',
        price: 3500000,
        description: 'Cho m√°y gi·∫∑t kh·ªëi l∆∞·ª£ng > 10kg.',
        keywords: ['m√°y gi·∫∑t', 'vneep']
    },
    {
        id: 'wash-emc',
        name: 'M√°y gi·∫∑t (EMC)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'Th·ª≠ nghi·ªám Nhi·ªÖu ƒëi·ªán t·ª´',
        price: 9000000,
        description: 'Th·ª≠ nghi·ªám EMC b·∫Øt bu·ªôc.',
        keywords: ['m√°y gi·∫∑t', 'emc']
    },

    // =========================================================================
    // 3. NH√ìM GIA D·ª§NG NH·ªé (M√°y xay, √©p, h√∫t b·ª•i...) - ƒê√É B·ªî SUNG
    // =========================================================================
    {
        id: 'household-cert',
        name: 'M√°y xay/√©p/ƒë√°nh tr·ª©ng (Ch·ª©ng nh·∫≠n)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'C·∫•p Gi·∫•y ch·ª©ng nh·∫≠n H·ª£p quy',
        price: 2000000,
        description: 'ƒê·ªìng gi√° cho: M√°y xay sinh t·ªë, M√°y √©p tr√°i c√¢y, M√°y xay th·ªãt, M√°y ƒë√°nh tr·ª©ng.',
        keywords: ['m√°y xay', 'm√°y √©p', 'm√°y ƒë√°nh tr·ª©ng', 'blender', 'juicer']
    },
    {
        id: 'household-emc',
        name: 'M√°y xay/√©p/ƒë√°nh tr·ª©ng (EMC)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'Th·ª≠ nghi·ªám Nhi·ªÖu ƒëi·ªán t·ª´',
        price: 5000000,
        description: 'Th·ª≠ nghi·ªám EMC cho thi·∫øt b·ªã d√πng ƒë·ªông c∆°.',
        keywords: ['m√°y xay', 'm√°y √©p', 'emc']
    },
    {
        id: 'vacuum-emc-1',
        name: 'M√°y h√∫t b·ª•i (1 ƒë·ªông c∆°) (EMC)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'Th·ª≠ nghi·ªám EMC',
        price: 5000000,
        description: 'Cho lo·∫°i 1 ƒë·ªông c∆°.',
        keywords: ['m√°y h√∫t b·ª•i', 'vacuum', 'emc']
    },
    {
        id: 'vacuum-emc-2',
        name: 'M√°y h√∫t b·ª•i (>= 2 ƒë·ªông c∆°) (EMC)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'Th·ª≠ nghi·ªám EMC',
        price: 7000000,
        description: 'Cho lo·∫°i 2 ƒë·ªông c∆° tr·ªü l√™n.',
        keywords: ['m√°y h√∫t b·ª•i', 'vacuum', 'emc']
    },

    // =========================================================================
    // 4. NH√ìM ƒêI·ªÄU H√íA KH√îNG KH√ç
    // =========================================================================
    {
        id: 'ac-cert',
        name: 'ƒêi·ªÅu h√≤a (Ch·ª©ng nh·∫≠n)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'C·∫•p Gi·∫•y ch·ª©ng nh·∫≠n H·ª£p quy',
        price: 2000000,
        description: 'ƒêi·ªÅu h√≤a th∆∞·ªùng: 2tr. ƒêi·ªÅu h√≤a Multi: 3tr (+1tr/m·∫∑t l·∫°nh).',
        keywords: ['ƒëi·ªÅu h√≤a', 'm√°y l·∫°nh', 'ac']
    },
    {
        id: 'ac-vneep-inv',
        name: 'ƒêi·ªÅu h√≤a Inverter (VNEEP)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 7830:2021',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 20000000,
        description: 'ƒêi·ªÅu h√≤a bi·∫øn t·∫ßn <= 60.000 BTU.',
        keywords: ['ƒëi·ªÅu h√≤a', 'inverter']
    },
    {
        id: 'ac-vneep-non',
        name: 'ƒêi·ªÅu h√≤a C∆° (VNEEP)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 7830:2021',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 15000000,
        description: 'ƒêi·ªÅu h√≤a th∆∞·ªùng (Non-Inverter).',
        keywords: ['ƒëi·ªÅu h√≤a', 'c∆°', 'non-inverter']
    },
    {
        id: 'ac-emc',
        name: 'ƒêi·ªÅu h√≤a (EMC)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'Th·ª≠ nghi·ªám EMC',
        price: 13000000,
        description: '13tr (<24000 BTU 1 chi·ªÅu). 15tr (>=24000 BTU, 2 chi·ªÅu ho·∫∑c Multi).',
        keywords: ['ƒëi·ªÅu h√≤a', 'emc']
    },

    // =========================================================================
    // 5. NH√ìM TIVI & M√ÄN H√åNH
    // =========================================================================
    {
        id: 'tv-vneep',
        name: 'Tivi (Hi·ªáu su·∫•t nƒÉng l∆∞·ª£ng)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 9536:2021',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t (VNEEP)',
        price: 3500000,
        description: '√Åp d·ª•ng cho M√°y thu h√¨nh (Tivi). > 75 inch ph√≠ nh√¢n 1.3.',
        keywords: ['tivi', 'tv', 'television']
    },
    {
        id: 'monitor-vneep',
        name: 'M√†n h√¨nh m√°y t√≠nh',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 9508:2012',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 2500000,
        description: '1.5tr (<= 40 inch); 2.5tr (> 40 inch).',
        keywords: ['m√†n h√¨nh', 'monitor']
    },

    // =========================================================================
    // 6. NH√ìM B·∫æP & L√í & N·ªíI C∆†M
    // =========================================================================
    {
        id: 'micro-full',
        name: 'L√≤ vi s√≥ng (Combo H·ª£p quy)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9 & QCVN 4',
        service: 'Tr·ªçn g√≥i (Cert + Safety + EMC)',
        price: 20000000,
        description: 'Combo: Cert(2tr) + Safety(8tr) + EMC(10tr). Ch∆∞a g·ªìm VNEEP.',
        keywords: ['l√≤ vi s√≥ng', 'microwave']
    },
    {
        id: 'micro-vneep',
        name: 'L√≤ vi s√≥ng (VNEEP)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 13663:2023',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 20000000,
        description: 'D√°n nh√£n nƒÉng l∆∞·ª£ng l√≤ vi s√≥ng.',
        keywords: ['l√≤ vi s√≥ng', 'vneep']
    },
    {
        id: 'hob-emc',
        name: 'B·∫øp t·ª´/H·ªìng ngo·∫°i (EMC)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9:2012/BKHCN',
        service: 'Th·ª≠ nghi·ªám EMC',
        price: 6000000,
        description: '6tr (1 v√πng n·∫•u), 7tr (>= 2 v√πng n·∫•u).',
        keywords: ['b·∫øp t·ª´', 'b·∫øp h·ªìng ngo·∫°i', 'b·∫øp ƒëi·ªán']
    },
    {
        id: 'rice-safety',
        name: 'N·ªìi c∆°m ƒëi·ªán (An to√†n)',
        category: FilterCategory.SAFETY,
        standard: 'QCVN 4:2009/BKHCN',
        service: 'Th·ª≠ nghi·ªám An to√†n ƒëi·ªán',
        price: 6000000,
        description: 'Th·ª≠ nghi·ªám Safety l·∫ßn ƒë·∫ßu.',
        keywords: ['n·ªìi c∆°m', 'rice cooker']
    },
    {
        id: 'rice-vneep',
        name: 'N·ªìi c∆°m ƒëi·ªán (VNEEP)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 8252:2015',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 2000000,
        description: 'D√°n nh√£n nƒÉng l∆∞·ª£ng.',
        keywords: ['n·ªìi c∆°m', 'vneep']
    },

    // =========================================================================
    // 7. NH√ìM QU·∫†T & M√ÅY S·∫§Y
    // =========================================================================
    {
        id: 'fan-safety',
        name: 'Qu·∫°t ƒëi·ªán (An to√†n)',
        category: FilterCategory.SAFETY,
        standard: 'QCVN 4:2009/BKHCN',
        service: 'Th·ª≠ nghi·ªám An to√†n ƒëi·ªán',
        price: 6000000,
        description: 'Qu·∫°t b√†n, qu·∫°t ƒë·ª©ng, qu·∫°t t∆∞·ªùng.',
        keywords: ['qu·∫°t', 'fan']
    },
    {
        id: 'fan-vneep',
        name: 'Qu·∫°t ƒëi·ªán (VNEEP)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 7826:2015',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 2000000,
        description: '2tr (< 50W), 3tr (>= 50W). Qu·∫°t tr·∫ßn: 4tr.',
        keywords: ['qu·∫°t', 'vneep']
    },
    {
        id: 'hair-combo',
        name: 'M√°y s·∫•y t√≥c (Combo)',
        category: FilterCategory.CR_HOUSEHOLD,
        standard: 'QCVN 9 & QCVN 4',
        service: 'Tr·ªçn g√≥i (Cert + Safety + EMC)',
        price: 13000000,
        description: 'Cert(2tr) + Safety(6tr) + EMC(5tr).',
        keywords: ['m√°y s·∫•y t√≥c', 'hair dryer']
    },

    // =========================================================================
    // 8. NH√ìM CNTT & VI·ªÑN TH√îNG (CNTT, 5G, Wifi)
    // =========================================================================
    {
        id: 'laptop-safety',
        name: 'Laptop/M√°y t√≠nh (An to√†n)',
        category: FilterCategory.SAFETY,
        standard: 'QCVN 132:2022/BTTTT',
        service: 'Th·ª≠ nghi·ªám An to√†n (IEC 62368)',
        price: 23000000,
        description: 'G√≥i c∆° b·∫£n g·ªìm th√¢n m√°y + 1 adapter.',
        keywords: ['laptop', 'm√°y t√≠nh', 'notebook']
    },
    {
        id: 'laptop-vneep',
        name: 'Laptop/M√°y t√≠nh (Hi·ªáu su·∫•t)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 11848:2021',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 3000000,
        description: 'Th·ª≠ nghi·ªám VNEEP cho Laptop.',
        keywords: ['laptop', 'vneep']
    },
    {
        id: 'phone-sar',
        name: 'ƒêi·ªán tho·∫°i 5G (SAR)',
        category: FilterCategory.SAR,
        standard: 'QCVN 134:2024/BTTTT',
        service: 'Th·ª≠ nghi·ªám SAR',
        price: 1300000000,
        description: '√Åp d·ª•ng cho m√°y 5G full t√≠nh nƒÉng. C√≥ ∆∞u ƒë√£i combo.',
        keywords: ['ƒëi·ªán tho·∫°i', '5g', 'sar']
    },
    {
        id: 'wifi-rf',
        name: 'Router Wifi (RF)',
        category: FilterCategory.CR_TELECOM,
        standard: 'QCVN 54 & 65',
        service: 'Th·ª≠ nghi·ªám V√¥ tuy·∫øn',
        price: 14000000,
        description: 'Combo bƒÉng t·∫ßn 2.4GHz (7tr) + 5GHz (7tr).',
        keywords: ['wifi', 'router', 'access point']
    },
    {
        id: 'battery-lithium',
        name: 'Pin Lithium (Safety)',
        category: FilterCategory.SAFETY,
        standard: 'QCVN 101:2020/BTTTT',
        service: 'Th·ª≠ nghi·ªám An to√†n Pin',
        price: 16000000,
        description: 'Tr·ªçn g√≥i Pack + 1 lo·∫°i Cell. C·∫ßn 22 Pack + 38 Cell.',
        keywords: ['pin', 'battery', 'lithium']
    },

    // =========================================================================
    // 9. NH√ìM ·ªî C·∫ÆM & ƒê√àN LED
    // =========================================================================
    {
        id: 'socket-combo',
        name: '·ªî c·∫Øm & Ph√≠ch c·∫Øm (Tr·ªçn g√≥i)',
        category: FilterCategory.SOCKET,
        standard: 'QCVN 25:2025/BKHCN',
        service: 'Th·ª≠ nghi·ªám + Ch·ª©ng nh·∫≠n',
        price: 23000000,
        description: 'Combo: Th·ª≠ nghi·ªám (18tr) + Ch·ª©ng nh·∫≠n (5tr). B·∫Øt bu·ªôc 2026.',
        keywords: ['·ªï c·∫Øm', 'ph√≠ch c·∫Øm', 'socket']
    },
    {
        id: 'led-cert',
        name: 'ƒê√®n LED (H·ª£p quy)',
        category: FilterCategory.ENERGY,
        standard: 'QCVN 19:2019/BKHCN',
        service: 'Th·ª≠ nghi·ªám & Ch·ª©ng nh·∫≠n',
        price: 25000000,
        description: 'Tr·ªçn g√≥i ES, EMI, EMS, PBS. Ch∆∞a g·ªìm IP.',
        keywords: ['ƒë√®n', 'led', 'light']
    },
    {
        id: 'led-vneep',
        name: 'ƒê√®n LED (Hi·ªáu su·∫•t)',
        category: FilterCategory.ENERGY,
        standard: 'TCVN 11844:2017',
        service: 'Th·ª≠ nghi·ªám Hi·ªáu su·∫•t',
        price: 4000000,
        description: 'D√°n nh√£n nƒÉng l∆∞·ª£ng ƒë√®n LED.',
        keywords: ['ƒë√®n', 'led', 'vneep']
    }
];

// ==========================================
// 3. HELPER FUNCTIONS
// ==========================================

const formatVND = (price) => {
  return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
};

const normalizeStr = (str) => {
  return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
};

// ==========================================
// 4. MAIN APP COMPONENT
// ==========================================

const App = () => {
  const [activeTab, setActiveTab] = useState(Tab.Home);
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState(FilterCategory.ALL);
  const [quoteItems, setQuoteItems] = useState([]);
  const [showSuggestions, setShowSuggestions] = useState(false);
  const searchRef = useRef(null);

  // --- Logic Gi·ªè h√†ng ---
  const addToQuote = (product) => {
    setQuoteItems(prev => {
      const existing = prev.find(item => item.id === product.id);
      if (existing) {
        return prev.map(item => item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item);
      }
      return [...prev, { ...product, quantity: 1 }];
    });
    setShowSuggestions(false);
    setSearchQuery('');
  };

  const removeFromQuote = (id) => setQuoteItems(prev => prev.filter(item => item.id !== id));

  const updateQuantity = (id, delta) => {
    setQuoteItems(prev => prev.map(item => {
      if (item.id === id) return { ...item, quantity: Math.max(1, item.quantity + delta) };
      return item;
    }));
  };

  const totalAmount = useMemo(() => quoteItems.reduce((acc, curr) => acc + (curr.price * curr.quantity), 0), [quoteItems]);

  // --- Logic T√¨m ki·∫øm & G·ª£i √Ω ---
  const suggestions = useMemo(() => {
    if (!searchQuery.trim()) return [];
    const query = normalizeStr(searchQuery);
    return MOCK_PRODUCTS.filter(p => {
      const matchName = normalizeStr(p.name).includes(query);
      const matchKey = p.keywords ? p.keywords.some(k => normalizeStr(k).includes(query)) : false;
      const matchStandard = normalizeStr(p.standard).includes(query);
      return matchName || matchKey || matchStandard;
    }).slice(0, 6);
  }, [searchQuery]);

  const filteredProducts = useMemo(() => {
    let data = MOCK_PRODUCTS;
    if (selectedCategory !== FilterCategory.ALL) {
      data = data.filter(p => p.category === selectedCategory);
    }
    if (searchQuery.trim()) {
      const query = normalizeStr(searchQuery);
      data = data.filter(p => {
        const matchName = normalizeStr(p.name).includes(query);
        const matchKey = p.keywords ? p.keywords.some(k => normalizeStr(k).includes(query)) : false;
        const matchStandard = normalizeStr(p.standard).includes(query);
        return matchName || matchKey || matchStandard;
      });
    }
    return data;
  }, [searchQuery, selectedCategory]);

  // Click outside to close suggestions
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (searchRef.current && !searchRef.current.contains(event.target)) {
        setShowSuggestions(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-20 flex flex-col">
      {/* HEADER */}
      <header className="sticky top-0 z-50 bg-white/95 backdrop-blur shadow-sm border-b border-slate-200 px-4 py-3">
        <div className="max-w-4xl mx-auto flex items-center justify-between mb-3">
          <div className="flex items-center gap-2 cursor-pointer" onClick={() => setActiveTab(Tab.Home)}>
            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">P</div>
            <div>
              <h1 className="text-lg font-extrabold text-slate-900 leading-none">PGL <span className="text-blue-600">Quote</span></h1>
              <p className="text-[10px] text-slate-500 font-medium uppercase tracking-wider flex items-center gap-1">
                <LucideInfo className="w-3 h-3" />
                {QUOTATION_INFO.number} ‚Ä¢ {QUOTATION_INFO.date}
              </p>
            </div>
          </div>
          <div className="relative cursor-pointer" onClick={() => setActiveTab(Tab.Quotes)}>
            <LucideShoppingCart className="text-slate-600 w-6 h-6 hover:text-blue-600 transition-colors" />
            {quoteItems.length > 0 && (
              <span className="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold w-4 h-4 flex items-center justify-center rounded-full border border-white">
                {quoteItems.length}
              </span>
            )}
          </div>
        </div>

        {/* SEARCH BAR (GLOBAL) */}
        {activeTab !== Tab.Account && (
          <div className="max-w-4xl mx-auto relative" ref={searchRef}>
            <div className="relative group">
              <LucideSearch className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4 group-focus-within:text-blue-500 transition-colors" />
              <input
                type="text"
                className="w-full bg-slate-100 border-none rounded-xl pl-10 pr-10 py-2.5 text-sm focus:ring-2 focus:ring-blue-500/20 focus:bg-white transition-all outline-none"
                placeholder="T√¨m thi·∫øt b·ªã: T·ªß l·∫°nh, M√°y gi·∫∑t, ƒêi·ªÅu h√≤a..."
                value={searchQuery}
                onFocus={() => setShowSuggestions(true)}
                onChange={(e) => {
                  setSearchQuery(e.target.value);
                  setShowSuggestions(true);
                  if (activeTab !== Tab.Search && e.target.value) setActiveTab(Tab.Search);
                }}
              />
              {searchQuery && (
                <button onClick={() => setSearchQuery('')} className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                  <LucideX className="w-4 h-4" />
                </button>
              )}
            </div>

            {/* SUGGESTIONS DROPDOWN */}
            {showSuggestions && suggestions.length > 0 && (
              <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200">
                <div className="px-4 py-2 bg-slate-50 text-[10px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100">
                  G·ª£i √Ω nhanh
                </div>
                {suggestions.map((item) => (
                  <div
                    key={item.id}
                    onClick={() => addToQuote(item)}
                    className="flex justify-between items-center px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-slate-50 last:border-0 group transition-colors"
                  >
                    <div>
                      <div className="font-bold text-sm text-slate-800 group-hover:text-blue-700">{item.name}</div>
                      <div className="text-xs text-slate-500 flex items-center gap-2 mt-0.5">
                        <span className="bg-slate-100 px-1.5 py-0.5 rounded text-[10px] font-bold text-slate-600">{item.standard}</span>
                        <span className="truncate max-w-[180px]">{item.service}</span>
                      </div>
                    </div>
                    <div className="text-blue-600 font-bold text-sm whitespace-nowrap group-hover:scale-105 transition-transform">
                      {formatVND(item.price)}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}
      </header>

      {/* MAIN CONTENT AREA */}
      <main className="flex-1 max-w-4xl mx-auto w-full p-4">
        
        {/* === TAB HOME === */}
        {activeTab === Tab.Home && (
          <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500">
            {/* Quick Categories */}
            <section>
              <h2 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                <LucideCheckCircle className="w-5 h-5 text-green-500" />
                Truy c·∫≠p nhanh
              </h2>
              <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                {[
                  { label: 'T·ªß l·∫°nh', icon: '‚ùÑÔ∏è', key: 't·ªß l·∫°nh', color: 'bg-cyan-100 text-cyan-700 border-cyan-200' },
                  { label: 'M√°y gi·∫∑t', icon: 'üß∫', key: 'm√°y gi·∫∑t', color: 'bg-indigo-100 text-indigo-700 border-indigo-200' },
                  { label: 'ƒêi·ªÅu h√≤a', icon: 'üí®', key: 'ƒëi·ªÅu h√≤a', color: 'bg-blue-100 text-blue-700 border-blue-200' },
                  { label: 'Tivi', icon: 'üì∫', key: 'tivi', color: 'bg-purple-100 text-purple-700 border-purple-200' },
                ].map((cat) => (
                  <button
                    key={cat.key}
                    onClick={() => { setSearchQuery(cat.key); setActiveTab(Tab.Search); }}
                    className={`p-4 rounded-xl border ${cat.color} flex flex-col items-center justify-center gap-2 hover:brightness-95 transition-all shadow-sm active:scale-95`}
                  >
                    <span className="text-2xl">{cat.icon}</span>
                    <span className="font-bold text-xs uppercase tracking-wide">{cat.label}</span>
                  </button>
                ))}
              </div>
            </section>

            {/* Featured Services */}
            <section>
              <h2 className="font-bold text-slate-800 mb-3 flex justify-between items-center">
                <span>D·ªãch v·ª• n·ªïi b·∫≠t</span>
                <span className="text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-500 font-normal">C·∫≠p nh·∫≠t: {QUOTATION_INFO.date}</span>
              </h2>
              <div className="space-y-3">
                {MOCK_PRODUCTS.slice(0, 5).map((prod) => (
                  <ProductCard key={prod.id} product={prod} onAdd={() => addToQuote(prod)} />
                ))}
              </div>
              <button 
                onClick={() => setActiveTab(Tab.Search)}
                className="w-full mt-4 py-3 bg-white border border-slate-200 text-slate-600 font-bold rounded-xl hover:bg-slate-50 transition-colors text-sm"
              >
                Xem t·∫•t c·∫£ d·ªãch v·ª•
              </button>
            </section>
          </div>
        )}

        {/* === TAB SEARCH === */}
        {activeTab === Tab.Search && (
          <div className="animate-in fade-in duration-300">
            {/* Filter Tags */}
            <div className="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-2">
              {Object.values(FilterCategory).map(cat => (
                <button
                  key={cat}
                  onClick={() => setSelectedCategory(cat)}
                  className={`px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border ${
                    selectedCategory === cat
                      ? 'bg-slate-800 text-white border-slate-800'
                      : 'bg-white text-slate-600 border-slate-200 hover:border-slate-400'
                  }`}
                >
                  {cat}
                </button>
              ))}
            </div>

            <div className="mb-4 text-xs text-slate-500">
              Hi·ªÉn th·ªã <span className="font-bold text-slate-800">{filteredProducts.length}</span> k·∫øt qu·∫£
              {searchQuery && <span> cho t·ª´ kh√≥a "<span className="font-bold">{searchQuery}</span>"</span>}
            </div>

            <div className="space-y-3">
              {filteredProducts.length > 0 ? (
                filteredProducts.map((prod) => (
                  <ProductCard key={prod.id} product={prod} onAdd={() => addToQuote(prod)} />
                ))
              ) : (
                <div className="text-center py-16">
                  <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 mb-4">
                    <LucideSearch className="w-8 h-8 text-slate-300" />
                  </div>
                  <p className="text-slate-500 font-medium">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>
                  <button onClick={() => {setSearchQuery(''); setSelectedCategory(FilterCategory.ALL)}} className="text-blue-600 text-xs font-bold mt-2 hover:underline">X√≥a b·ªô l·ªçc</button>
                </div>
              )}
            </div>
          </div>
        )}

        {/* === TAB QUOTES === */}
        {activeTab === Tab.Quotes && (
          <div className="animate-in slide-in-from-right-4 duration-300">
            <div className="flex justify-between items-end border-b border-slate-200 pb-3 mb-4">
              <div>
                <h2 className="font-bold text-xl text-slate-800">B√°o gi√° d·ª± ki·∫øn</h2>
                <p className="text-xs text-slate-500">Danh s√°ch c√°c h·∫°ng m·ª•c ƒë√£ ch·ªçn</p>
              </div>
              {quoteItems.length > 0 && (
                <button onClick={() => setQuoteItems([])} className="text-red-500 text-xs font-bold hover:bg-red-50 px-2 py-1 rounded transition-colors flex items-center gap-1">
                  <LucideTrash2 className="w-3 h-3" /> X√≥a h·∫øt
                </button>
              )}
            </div>

            {quoteItems.length > 0 ? (
              <>
                <div className="space-y-3 mb-20">
                  {quoteItems.map((item) => (
                    <div key={item.id} className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                      <div className="flex-1">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="bg-blue-50 text-blue-700 px-1.5 py-0.5 rounded text-[10px] font-bold uppercase">{item.standard}</span>
                        </div>
                        <h4 className="font-bold text-slate-800 text-sm">{item.name}</h4>
                        <p className="text-xs text-slate-500 mt-0.5">{item.service}</p>
                        <div className="text-blue-600 font-bold text-sm mt-1 sm:hidden">
                          {formatVND(item.price)}
                        </div>
                      </div>

                      <div className="flex items-center justify-between sm:justify-end gap-4 border-t sm:border-t-0 border-slate-50 pt-3 sm:pt-0">
                        <div className="hidden sm:block text-right mr-4">
                          <div className="text-blue-600 font-bold text-sm">{formatVND(item.price)}</div>
                          <div className="text-[10px] text-slate-400">ƒê∆°n gi√°</div>
                        </div>
                        
                        <div className="flex items-center bg-slate-50 rounded-lg border border-slate-200 p-1">
                          <button onClick={() => updateQuantity(item.id, -1)} className="w-7 h-7 flex items-center justify-center bg-white rounded hover:bg-slate-100 shadow-sm transition-colors text-slate-600">
                            <LucideMinus className="w-3 h-3" />
                          </button>
                          <span className="w-8 text-center font-bold text-sm text-slate-800">{item.quantity}</span>
                          <button onClick={() => updateQuantity(item.id, 1)} className="w-7 h-7 flex items-center justify-center bg-white rounded hover:bg-slate-100 shadow-sm transition-colors text-slate-600">
                            <LucidePlus className="w-3 h-3" />
                          </button>
                        </div>

                        <button onClick={() => removeFromQuote(item.id)} className="text-slate-300 hover:text-red-500 transition-colors p-1">
                          <LucideTrash2 className="w-4 h-4" />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>

                {/* Bottom Summary Bar */}
                <div className="fixed bottom-16 left-0 right-0 p-4 bg-white border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-40 max-w-md mx-auto sm:max-w-full sm:static sm:shadow-none sm:border-0 sm:bg-transparent sm:p-0">
                   <div className="max-w-4xl mx-auto">
                      <div className="bg-slate-900 text-white p-5 rounded-2xl shadow-xl">
                        <div className="flex justify-between items-center mb-4">
                          <span className="text-slate-400 text-sm font-medium">T·ªïng c·ªông (ch∆∞a VAT):</span>
                          <span className="text-2xl font-bold text-blue-400">{formatVND(totalAmount)}</span>
                        </div>
                        <button className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3.5 rounded-xl transition-all active:scale-[0.98] flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20">
                          <LucideMail className="w-4 h-4" />
                          G·ª≠i y√™u c·∫ßu b√°o gi√° ch√≠nh th·ª©c
                        </button>
                        <p className="text-[10px] text-center mt-3 text-slate-500 italic flex items-center justify-center gap-1">
                          <LucideAlertCircle className="w-3 h-3" />
                          Gi√° tr·ªã th·ª±c t·∫ø c√≥ th·ªÉ thay ƒë·ªïi t√πy theo y√™u c·∫ßu k·ªπ thu·∫≠t.
                        </p>
                      </div>
                   </div>
                </div>
              </>
            ) : (
              <div className="text-center py-16 bg-white rounded-2xl border-2 border-dashed border-slate-100">
                <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-50 mb-4">
                  <LucideShoppingCart className="w-8 h-8 text-blue-200" />
                </div>
                <h3 className="font-bold text-slate-800">Gi·ªè h√†ng tr·ªëng</h3>
                <p className="text-sm text-slate-500 mt-1 mb-6">B·∫°n ch∆∞a ch·ªçn d·ªãch v·ª• n√†o.</p>
                <button onClick={() => setActiveTab(Tab.Home)} className="bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-bold shadow-lg hover:bg-blue-700 transition-colors">
                  Kh√°m ph√° d·ªãch v·ª• ngay
                </button>
              </div>
            )}
          </div>
        )}

        {/* === TAB ACCOUNT === */}
        {activeTab === Tab.Account && (
          <div className="flex flex-col items-center justify-center py-12 animate-in zoom-in duration-300">
            <div className="w-24 h-24 bg-gradient-to-tr from-slate-200 to-slate-100 rounded-full flex items-center justify-center text-slate-400 mb-4 shadow-inner border-4 border-white">
              <LucideUser className="w-10 h-10" />
            </div>
            <h2 className="text-xl font-bold text-slate-800">Kh√°ch h√†ng</h2>
            <p className="text-sm text-slate-500">Ch∆∞a ƒëƒÉng nh·∫≠p</p>
            <div className="w-full max-w-xs mt-8 space-y-3">
              <button className="w-full bg-white border border-slate-200 p-3 rounded-xl font-bold text-sm text-slate-700 hover:bg-slate-50">ƒêƒÉng nh·∫≠p</button>
              <button className="w-full bg-slate-800 p-3 rounded-xl font-bold text-sm text-white hover:bg-slate-900">ƒêƒÉng k√Ω t√†i kho·∫£n</button>
            </div>
          </div>
        )}
      </main>

      {/* BOTTOM NAVIGATION */}
      <nav className="fixed bottom-0 w-full bg-white border-t border-slate-100 pb-safe pt-1 px-2 z-50 shadow-[0_-4px_20px_rgba(0,0,0,0.03)]">
        <div className="max-w-md mx-auto flex justify-between items-center">
          <NavButton icon={LucideHome} label="Trang ch·ªß" isActive={activeTab === Tab.Home} onClick={() => setActiveTab(Tab.Home)} />
          <NavButton icon={LucideSearch} label="Tra c·ª©u" isActive={activeTab === Tab.Search} onClick={() => setActiveTab(Tab.Search)} />
          <NavButton icon={LucideShoppingCart} label="B√°o gi√°" isActive={activeTab === Tab.Quotes} onClick={() => setActiveTab(Tab.Quotes)} badge={quoteItems.length} />
          <NavButton icon={LucideUser} label="C√° nh√¢n" isActive={activeTab === Tab.Account} onClick={() => setActiveTab(Tab.Account)} />
        </div>
      </nav>
    </div>
  );
};

// --- Sub Components ---

const NavButton = ({ icon: Icon, label, isActive, onClick, badge }) => (
  <button
    onClick={onClick}
    className={`flex-1 flex flex-col items-center justify-center py-2.5 transition-all duration-300 ${isActive ? 'text-blue-600' : 'text-slate-400 hover:text-slate-600'}`}
  >
    <div className="relative">
      <Icon className={`w-6 h-6 transition-transform ${isActive ? 'scale-110' : ''} ${isActive ? 'stroke-[2.5px]' : 'stroke-[2px]'}`} />
      {badge > 0 && (
        <span className="absolute -top-1.5 -right-2 bg-red-500 text-white text-[9px] font-bold h-4 w-4 flex items-center justify-center rounded-full border-2 border-white shadow-sm">
          {badge}
        </span>
      )}
    </div>
    <span className={`text-[10px] font-bold mt-1 ${isActive ? 'opacity-100' : 'opacity-70'}`}>{label}</span>
  </button>
);

const ProductCard = ({ product, onAdd }) => (
  <div className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-all group active:scale-[0.99] cursor-pointer" onClick={onAdd}>
    <div className="flex justify-between items-start mb-2">
      <span className="bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border border-slate-200">
        {product.standard}
      </span>
      <span className="text-[10px] font-bold text-slate-400 uppercase">{product.category}</span>
    </div>
    <div className="flex justify-between items-center">
      <div className="flex-1 pr-4">
        <h3 className="font-bold text-slate-800 text-sm group-hover:text-blue-600 transition-colors">{product.name}</h3>
        <p className="text-xs text-slate-500 mt-1 line-clamp-2">{product.service}</p>
        <p className="text-[10px] text-slate-400 mt-1 italic line-clamp-1">{product.description}</p>
      </div>
      <div className="text-right flex flex-col items-end gap-2">
        <span className="text-blue-600 font-extrabold text-sm">{formatVND(product.price)}</span>
        <button className="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-600 hover:text-white transition-all shadow-sm">
          <LucidePlus className="w-4 h-4" />
        </button>
      </div>
    </div>
  </div>
);

export default App;